{% extends "base.html" %}

{% block content %}
<div class="row">
    <!-- Vista General de WireGuard -->
    <div class="col-12 mb-4">
        <div class="card">
            <div class="card-header">
                <h5 class="card-title mb-0">
                    <i class="bi bi-shield-check"></i>
                    {{ t('wireguard.overview') }}
                </h5>
            </div>
            <div class="card-body">
                <div class="row">
                    <div class="col-md-3 mb-3">
                        <div class="text-center">
                            <i class="bi bi-ethernet text-primary" style="font-size: 2rem;"></i>
                            <h6 class="mt-2">{{ t('wireguard.interfaces') }}</h6>
                            <h4 class="text-primary">{{ wireguard_stats.interfaces_count | default(2) }}</h4>
                        </div>
                    </div>
                    <div class="col-md-3 mb-3">
                        <div class="text-center">
                            <i class="bi bi-people text-success" style="font-size: 2rem;"></i>
                            <h6 class="mt-2">{{ t('wireguard.peers') }}</h6>
                            <h4 class="text-success">{{ wireguard_stats.peers_count | default(5) }}</h4>
                        </div>
                    </div>
                    <div class="col-md-3 mb-3">
                        <div class="text-center">
                            <i class="bi bi-speedometer2 text-warning" style="font-size: 2rem;"></i>
                            <h6 class="mt-2">{{ t('wireguard.bandwidth') }}</h6>
                            <h4 class="text-warning">{{ wireguard_stats.total_bandwidth | default('100 Mbps') }}</h4>
                        </div>
                    </div>
                    <div class="col-md-3 mb-3">
                        <div class="text-center">
                            <i class="bi bi-shield-check text-info" style="font-size: 2rem;"></i>
                            <h6 class="mt-2">{{ t('wireguard.security') }}</h6>
                            <h4 class="text-info">{{ t('wireguard.active') }}</h4>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Estado de WireGuard -->
    <div class="col-md-4 mb-4">
        <div class="card">
            <div class="card-header">
                <h5 class="card-title mb-0">
                    <i class="bi bi-heart-pulse"></i>
                    {{ t('wireguard.status') }}
                </h5>
            </div>
            <div class="card-body">
                <div class="d-flex align-items-center mb-3">
                    <span class="status-indicator status-{{ 'online' if wireguard_status.enabled else 'offline' }}"></span>
                    <span>{{ t('wireguard.wireguard_enabled' if wireguard_status.enabled else 'wireguard.wireguard_disabled') }}</span>
                </div>
                
                <div class="mb-3">
                    <label class="form-label">{{ t('wireguard.interface_name') }}</label>
                    <div class="d-flex align-items-center">
                        <i class="bi bi-ethernet text-primary me-2"></i>
                        <span class="h6 mb-0">{{ wireguard_status.interface_name | default('wg0') }}</span>
                    </div>
                </div>
                
                <div class="mb-3">
                    <label class="form-label">{{ t('wireguard.interface_address') }}</label>
                    <div class="d-flex align-items-center">
                        <i class="bi bi-geo-alt text-info me-2"></i>
                        <span class="h6 mb-0">{{ wireguard_status.interface_address | default('10.0.0.1/24') }}</span>
                    </div>
                </div>
                
                <div class="d-grid gap-2">
                    <button class="btn btn-outline-success" onclick="toggleWireGuard()">
                        <i class="bi bi-shield-check"></i>
                        {{ t('wireguard.enable_wireguard') if not wireguard_status.enabled else t('wireguard.disable_wireguard') }}
                    </button>
                    <button class="btn btn-outline-primary" onclick="restartWireGuard()">
                        <i class="bi bi-arrow-clockwise"></i>
                        {{ t('wireguard.restart_wireguard') }}
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Interfaces de WireGuard -->
    <div class="col-md-8 mb-4">
        <div class="card">
            <div class="card-header">
                <h5 class="card-title mb-0">
                    <i class="bi bi-ethernet"></i>
                    {{ t('wireguard.interfaces') }}
                </h5>
            </div>
            <div class="card-body">
                <div class="table-responsive">
                    <table class="table table-hover">
                        <thead>
                            <tr>
                                <th>{{ t('wireguard.interface_name') }}</th>
                                <th>{{ t('wireguard.interface_status') }}</th>
                                <th>{{ t('wireguard.interface_address') }}</th>
                                <th>{{ t('wireguard.peers_count') }}</th>
                                <th>{{ t('common.actions') }}</th>
                            </tr>
                        </thead>
                        <tbody id="interfacesTable">
                            <!-- Las interfaces se cargarán dinámicamente -->
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>

    <!-- Pares de WireGuard -->
    <div class="col-md-6 mb-4">
        <div class="card">
            <div class="card-header">
                <h5 class="card-title mb-0">
                    <i class="bi bi-people"></i>
                    {{ t('wireguard.peers') }}
                </h5>
            </div>
            <div class="card-body">
                <div class="table-responsive">
                    <table class="table table-sm">
                        <thead>
                            <tr>
                                <th>{{ t('wireguard.peer_name') }}</th>
                                <th>{{ t('wireguard.peer_status') }}</th>
                                <th>{{ t('wireguard.peer_bandwidth') }}</th>
                                <th>{{ t('wireguard.peer_uptime') }}</th>
                            </tr>
                        </thead>
                        <tbody id="peersTable">
                            <!-- Los pares se cargarán dinámicamente -->
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>

    <!-- Configuración de WireGuard -->
    <div class="col-md-6 mb-4">
        <div class="card">
            <div class="card-header">
                <h5 class="card-title mb-0">
                    <i class="bi bi-gear"></i>
                    {{ t('wireguard.configuration') }}
                </h5>
            </div>
            <div class="card-body">
                <form id="wireguardConfigForm">
                    <div class="mb-3">
                        <label for="interface_name" class="form-label">{{ t('wireguard.interface_name') }}</label>
                        <input type="text" class="form-control" id="interface_name" name="interface_name" value="{{ wireguard_config.interface_name | default('wg0') }}">
                    </div>
                    
                    <div class="mb-3">
                        <label for="interface_address" class="form-label">{{ t('wireguard.interface_address') }}</label>
                        <input type="text" class="form-control" id="interface_address" name="interface_address" value="{{ wireguard_config.interface_address | default('10.0.0.1/24') }}">
                    </div>
                    
                    <div class="mb-3">
                        <label for="listen_port" class="form-label">{{ t('wireguard.interface_listen_port') }}</label>
                        <input type="number" class="form-control" id="listen_port" name="listen_port" value="{{ wireguard_config.listen_port | default(51820) }}">
                    </div>
                    
                    <div class="mb-3">
                        <label for="mtu" class="form-label">{{ t('wireguard.interface_mtu') }}</label>
                        <input type="number" class="form-control" id="mtu" name="mtu" value="{{ wireguard_config.mtu | default(1420) }}">
                    </div>
                    
                    <div class="d-grid">
                        <button type="submit" class="btn btn-primary">
                            <i class="bi bi-check-circle"></i>
                            {{ t('common.save') }}
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- Estadísticas de WireGuard -->
    <div class="col-12 mb-4">
        <div class="card">
            <div class="card-header">
                <h5 class="card-title mb-0">
                    <i class="bi bi-graph-up"></i>
                    {{ t('wireguard.statistics') }}
                </h5>
            </div>
            <div class="card-body">
                <div class="row">
                    <div class="col-md-3 mb-3">
                        <div class="text-center">
                            <h6>{{ t('wireguard.total_traffic') }}</h6>
                            <h4 class="text-primary">{{ wireguard_stats.total_traffic | default('3.2 GB') }}</h4>
                        </div>
                    </div>
                    <div class="col-md-3 mb-3">
                        <div class="text-center">
                            <h6>{{ t('wireguard.active_peers') }}</h6>
                            <h4 class="text-success">{{ wireguard_stats.active_peers | default(3) }}</h4>
                        </div>
                    </div>
                    <div class="col-md-3 mb-3">
                        <div class="text-center">
                            <h6>{{ t('wireguard.peak_bandwidth') }}</h6>
                            <h4 class="text-warning">{{ wireguard_stats.peak_bandwidth | default('50 Mbps') }}</h4>
                        </div>
                    </div>
                    <div class="col-md-3 mb-3">
                        <div class="text-center">
                            <h6>{{ t('wireguard.uptime') }}</h6>
                            <h4 class="text-info">{{ wireguard_stats.uptime | default('7 días') }}</h4>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

{% block extra_js %}
<script src="/static/js/wireguard.js?v={{ last_update }}"></script>
{% endblock %}
