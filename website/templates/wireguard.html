{{ template "base.html" . }}

{{ define "content" }}
<div class="row">
    <!-- Vista General de WireGuard -->
    <div class="col-12 mb-4">
        <div class="card">
            <div class="card-header">
                <h5 class="card-title mb-0">
                    <i class="bi bi-shield-check"></i>
                    {{ call .t "wireguard.overview" "Overview" }}
                </h5>
            </div>
            <div class="card-body">
                <div class="row">
                    <div class="col-md-3 mb-3">
                        <div class="text-center">
                            <i class="bi bi-ethernet text-primary" style="font-size: 2rem;"></i>
                            <h6 class="mt-2">{{ call .t "wireguard.interfaces" "Interfaces" }}</h6>
                            <h4 class="text-primary">{{ if .wireguard_stats.interfaces_count }}{{ .wireguard_stats.interfaces_count }}{{ else }}2{{ end }}</h4>
                        </div>
                    </div>
                    <div class="col-md-3 mb-3">
                        <div class="text-center">
                            <i class="bi bi-people text-success" style="font-size: 2rem;"></i>
                            <h6 class="mt-2">{{ call .t "wireguard.peers" "Peers" }}</h6>
                            <h4 class="text-success">{{ if .wireguard_stats.peers_count }}{{ .wireguard_stats.peers_count }}{{ else }}5{{ end }}</h4>
                        </div>
                    </div>
                    <div class="col-md-3 mb-3">
                        <div class="text-center">
                            <i class="bi bi-speedometer2 text-warning" style="font-size: 2rem;"></i>
                            <h6 class="mt-2">{{ call .t "wireguard.bandwidth" "Bandwidth" }}</h6>
                            <h4 class="text-warning">{{ if .wireguard_stats.total_bandwidth }}{{ .wireguard_stats.total_bandwidth }}{{ else }}100 Mbps{{ end }}</h4>
                        </div>
                    </div>
                    <div class="col-md-3 mb-3">
                        <div class="text-center">
                            <i class="bi bi-shield-check text-info" style="font-size: 2rem;"></i>
                            <h6 class="mt-2">{{ call .t "wireguard.security" "Security" }}</h6>
                            <h4 class="text-info">{{ call .t "wireguard.active" "Active" }}</h4>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Estado de WireGuard -->
    <div class="col-md-4 mb-4">
        <div class="card">
            <div class="card-header">
                <h5 class="card-title mb-0">
                    <i class="bi bi-heart-pulse"></i>
                    {{ call .t "wireguard.status" "Status" }}
                </h5>
            </div>
            <div class="card-body">
                <div class="d-flex align-items-center mb-3">
                    <span class="status-indicator status-{{ if .wireguard_status.enabled }}online{{ else }}offline{{ end }}"></span>
                    <span>{{ if .wireguard_status.enabled }}{{ call .t "wireguard.wireguard_enabled" "Enabled" }}{{ else }}{{ call .t "wireguard.wireguard_disabled" "Disabled" }}{{ end }}</span>
                </div>
                
                <div class="mb-3">
                    <label class="form-label">{{ call .t "wireguard.interface_name" "Interface Name" }}</label>
                    <div class="d-flex align-items-center">
                        <i class="bi bi-ethernet text-primary me-2"></i>
                        <span class="h6 mb-0">{{ if .wireguard_status.interface_name }}{{ .wireguard_status.interface_name }}{{ else }}wg0{{ end }}</span>
                    </div>
                </div>
                
                <div class="mb-3">
                    <label class="form-label">{{ call .t "wireguard.interface_address" "Interface Address" }}</label>
                    <div class="d-flex align-items-center">
                        <i class="bi bi-geo-alt text-info me-2"></i>
                        <span class="h6 mb-0">{{ if .wireguard_status.interface_address }}{{ .wireguard_status.interface_address }}{{ else }}10.0.0.1/24{{ end }}</span>
                    </div>
                </div>
                
                <div class="d-grid gap-2">
                    <button class="btn btn-outline-success" onclick="toggleWireGuard()">
                        <i class="bi bi-shield-check"></i>
                        {{ if .wireguard_status.enabled }}{{ call .t "wireguard.disable_wireguard" "Disable" }}{{ else }}{{ call .t "wireguard.enable_wireguard" "Enable" }}{{ end }}
                    </button>
                    <button class="btn btn-outline-primary" onclick="restartWireGuard()">
                        <i class="bi bi-arrow-clockwise"></i>
                        {{ call .t "wireguard.restart_wireguard" "Restart" }}
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Interfaces de WireGuard -->
    <div class="col-md-8 mb-4">
        <div class="card">
            <div class="card-header">
                <h5 class="card-title mb-0">
                    <i class="bi bi-ethernet"></i>
                    {{ call .t "wireguard.interfaces" "Interfaces" }}
                </h5>
            </div>
            <div class="card-body">
                <div class="table-responsive">
                    <table class="table table-hover">
                        <thead>
                            <tr>
                                <th>{{ call .t "wireguard.interface_name" "Name" }}</th>
                                <th>{{ call .t "wireguard.interface_status" "Status" }}</th>
                                <th>{{ call .t "wireguard.interface_address" "Address" }}</th>
                                <th>{{ call .t "wireguard.peers_count" "Peers" }}</th>
                                <th>{{ call .t "common.actions" "Actions" }}</th>
                            </tr>
                        </thead>
                        <tbody id="interfacesTable">
                            <!-- Las interfaces se cargarán dinámicamente -->
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>

    <!-- Pares de WireGuard -->
    <div class="col-md-6 mb-4">
        <div class="card">
            <div class="card-header">
                <h5 class="card-title mb-0">
                    <i class="bi bi-people"></i>
                    {{ call .t "wireguard.peers" "Peers" }}
                </h5>
            </div>
            <div class="card-body">
                <div class="table-responsive">
                    <table class="table table-sm">
                        <thead>
                            <tr>
                                <th>{{ call .t "wireguard.peer_name" "Name" }}</th>
                                <th>{{ call .t "wireguard.peer_status" "Status" }}</th>
                                <th>{{ call .t "wireguard.peer_bandwidth" "Bandwidth" }}</th>
                                <th>{{ call .t "wireguard.peer_uptime" "Uptime" }}</th>
                            </tr>
                        </thead>
                        <tbody id="peersTable">
                            <!-- Los pares se cargarán dinámicamente -->
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>

    <!-- Configuración de WireGuard (wg0.conf) -->
    <div class="col-md-6 mb-4">
        <div class="card">
            <div class="card-header">
                <h5 class="card-title mb-0">
                    <i class="bi bi-gear"></i>
                    {{ call .t "wireguard.configuration" "Configuration" }}
                </h5>
            </div>
            <div class="card-body">
                <form id="wireguardConfigForm">
                    <div class="mb-3">
                        <label for="wg_config" class="form-label">{{ call .t "wireguard.configuration" "Configuration" }} (wg0.conf)</label>
                        <textarea class="form-control font-monospace" id="wg_config" name="config" rows="12" placeholder="[Interface]\nAddress = ...\nPrivateKey = ...\n\n[Peer]\nPublicKey = ...\nAllowedIPs = ..."></textarea>
                        <small class="text-muted">{{ call .t "wireguard.config_hint" "Se carga desde /etc/wireguard/wg0.conf (si existe) y se guarda vía API." }}</small>
                    </div>
                    
                    <div class="d-grid">
                        <button type="submit" class="btn btn-primary">
                            <i class="bi bi-check-circle"></i>
                            {{ call .t "common.save" "Save" }}
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- Estadísticas de WireGuard -->
    <div class="col-12 mb-4">
        <div class="card">
            <div class="card-header">
                <h5 class="card-title mb-0">
                    <i class="bi bi-graph-up"></i>
                    {{ call .t "wireguard.statistics" "Statistics" }}
                </h5>
            </div>
            <div class="card-body">
                <div class="row">
                    <div class="col-md-3 mb-3">
                        <div class="text-center">
                            <h6>{{ call .t "wireguard.total_traffic" "Total Traffic" }}</h6>
                            <h4 class="text-primary">{{ if .wireguard_stats.total_traffic }}{{ .wireguard_stats.total_traffic }}{{ else }}3.2 GB{{ end }}</h4>
                        </div>
                    </div>
                    <div class="col-md-3 mb-3">
                        <div class="text-center">
                            <h6>{{ call .t "wireguard.active_peers" "Active Peers" }}</h6>
                            <h4 class="text-success">{{ if .wireguard_stats.active_peers }}{{ .wireguard_stats.active_peers }}{{ else }}3{{ end }}</h4>
                        </div>
                    </div>
                    <div class="col-md-3 mb-3">
                        <div class="text-center">
                            <h6>{{ call .t "wireguard.peak_bandwidth" "Peak Bandwidth" }}</h6>
                            <h4 class="text-warning">{{ if .wireguard_stats.peak_bandwidth }}{{ .wireguard_stats.peak_bandwidth }}{{ else }}50 Mbps{{ end }}</h4>
                        </div>
                    </div>
                    <div class="col-md-3 mb-3">
                        <div class="text-center">
                            <h6>{{ call .t "wireguard.uptime" "Uptime" }}</h6>
                            <h4 class="text-info">{{ if .wireguard_stats.uptime }}{{ .wireguard_stats.uptime }}{{ else }}7 días{{ end }}</h4>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
{{ end }}

{{ define "extra_js" }}
<script src="/static/js/wireguard.js?v={{ .last_update }}"></script>
{{ end }}
