{% extends "base.html" %}

{% block content %}
<div class="dashboard-container">
    <!-- Header Section -->
    <div class="dashboard-header mb-4">
        <div class="row align-items-center">
            <div class="col-12 text-center">
                <h1 class="dashboard-title">
                    <i class="bi bi-speedometer2 me-2"></i>
                    {{ t('navigation.dashboard', 'Dashboard') }}
                </h1>
                <p class="dashboard-subtitle">{{ t('dashboard.welcome', 'Welcome to HostBerry') }}</p>
                <div class="dashboard-time">
                    <i class="bi bi-clock me-1"></i>
                    <span id="currentTime">--:--:--</span>
                </div>
            </div>
        </div>
    </div>

    <!-- System Status Cards (estética Monitoring) -->
    <div class="row mb-4">
        <!-- Uptime -->
        <div class="col-lg-3 col-md-6 mb-3">
            <div class="actions-card h-100 glass-card border-0 uptime-card">
                <div class="actions-card-header">
                    <h6 class="actions-card-title mb-0">
                        <i class="bi bi-clock-history me-2 text-white-50"></i>
                        {{ t('monitoring.uptime', 'Uptime') }}
                    </h6>
                </div>
                <div class="actions-card-body text-center">
                    <h2 class="text-white mb-2" id="uptime-value">{{ system_info.uptime | default('--') }}</h2>
                    <small class="text-white-50">{{ t('monitoring.since_boot', 'Since boot') }}</small>
                </div>
            </div>
        </div>

        <!-- CPU Usage -->
        <div class="col-lg-3 col-md-6 mb-3">
            <div class="actions-card h-100 glass-card border-0 cpu-card">
                <div class="actions-card-header">
                    <h6 class="actions-card-title mb-0">
                        <i class="bi bi-cpu me-2 text-white-50"></i>
                        {{ t('monitoring.cpu_usage', 'CPU Usage') }}
                    </h6>
                </div>
                <div class="actions-card-body">
                    <div class="text-center mb-2">
                        <h2 class="text-white mb-0" id="cpu-usage">{{ system_stats.cpu_percent | default(0, true) }}%</h2>
                    </div>
                    <div class="progress mb-2" style="height: 8px;">
                        <div id="cpu-progress" class="progress-bar bg-info cpu-progress" style="width: {{ system_stats.cpu_percent | default(0, true) }}%"></div>
                    </div>
                    <div class="d-flex justify-content-between text-white-50 small">
                        <span>{{ t('monitoring.cores', 'Cores') }}: <strong id="cpu-cores">{{ system_info.cpu_cores | default('-') }}</strong></span>
                        <span>{{ t('monitoring.temp', 'Temp') }}: <strong id="cpu-temp">{{ system_stats.temperature | default('--', true) }}°C</strong></span>
                    </div>
                    <div class="mt-2 text-center">
                        <span class="status-text status-healthy">{{ t('system.healthy', 'Healthy') }}</span>
                    </div>
                </div>
            </div>
        </div>

        <!-- Memory Usage -->
        <div class="col-lg-3 col-md-6 mb-3">
            <div class="actions-card h-100 glass-card border-0 memory-card">
                <div class="actions-card-header">
                    <h6 class="actions-card-title mb-0">
                        <i class="bi bi-memory me-2 text-white-50"></i>
                        {{ t('monitoring.memory_usage', 'Memory Usage') }}
                    </h6>
                </div>
                <div class="actions-card-body">
                    <div class="text-center mb-2">
                        <h2 class="text-white mb-0" id="mem-usage">{{ system_stats.memory_percent | default(0, true) }}%</h2>
                    </div>
                    <div class="progress mb-2" style="height: 8px;">
                        <div id="mem-progress" class="progress-bar bg-success memory-progress" style="width: {{ system_stats.memory_percent | default(0, true) }}%"></div>
                    </div>
                    <div class="text-center text-white-50 small">
                        <span>{{ t('monitoring.used_of', 'Used of') }} <strong id="mem-total">--</strong> · <span id="mem-free">--</span> {{ t('monitoring.free', 'free') }}</span>
                    </div>
                    <div class="mt-2 text-center">
                        <span class="status-text status-healthy">{{ t('system.healthy', 'Healthy') }}</span>
                    </div>
                </div>
            </div>
        </div>

        <!-- Disk Usage -->
        <div class="col-lg-3 col-md-6 mb-3">
            <div class="actions-card h-100 glass-card border-0 disk-card">
                <div class="actions-card-header">
                    <h6 class="actions-card-title mb-0">
                        <i class="bi bi-hdd me-2 text-white-50"></i>
                        {{ t('monitoring.disk_usage', 'Disk Usage') }}
                    </h6>
                </div>
                <div class="actions-card-body">
                    <div class="text-center mb-2">
                        <h2 class="text-white mb-0" id="disk-usage">{{ system_stats.disk_percent | default(0, true) }}%</h2>
                    </div>
                    <div class="progress mb-2" style="height: 8px;">
                        <div id="disk-progress" class="progress-bar bg-warning disk-progress" style="width: {{ system_stats.disk_percent | default(0, true) }}%"></div>
                    </div>
                    <div class="text-center text-white-50 small">
                        <span>{{ t('monitoring.used', 'Used') }} <strong id="disk-used">--</strong> / <span id="disk-total">--</span></span>
                    </div>
                    <div class="mt-2 text-center">
                        <span class="status-text status-healthy">{{ t('system.healthy', 'Healthy') }}</span>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- System Information -->
    <div class="row mb-4">
        <div class="col-12">
            <div class="info-card">
                <div class="info-card-header">
                    <h5 class="info-card-title">
                        <i class="bi bi-info-circle me-2"></i>
                        {{ t('system.information', 'System Information') }}
                    </h5>
                </div>
                <div class="info-card-body">
                    <div class="row">
                        <div class="col-lg-2 col-md-4 col-6 mb-3">
                            <div class="info-item-grid">
                                <span class="info-label d-block">{{ t('system.hostname', 'Hostname') }}</span>
                                <span class="info-value">{{ system_info.hostname | default('hostberry') }}</span>
                            </div>
                        </div>
                        <div class="col-lg-2 col-md-4 col-6 mb-3">
                            <div class="info-item-grid">
                                <span class="info-label d-block">{{ t('system.os_version', 'OS Version') }}</span>
                                <span class="info-value">{{ system_info.os_version | default('Raspberry Pi OS') }}</span>
                            </div>
                        </div>
                        <div class="col-lg-2 col-md-4 col-6 mb-3">
                            <div class="info-item-grid">
                                <span class="info-label d-block">{{ t('system.kernel_version', 'Kernel') }}</span>
                                <span class="info-value">{{ system_info.kernel_version | default('Linux 6.8.0') }}</span>
                            </div>
                        </div>
                        <div class="col-lg-2 col-md-4 col-6 mb-3">
                            <div class="info-item-grid">
                                <span class="info-label d-block">{{ t('system.architecture', 'Architecture') }}</span>
                                <span class="info-value">{{ system_info.architecture | default('armv7l') }}</span>
                            </div>
                        </div>
                        <div class="col-lg-2 col-md-4 col-6 mb-3">
                            <div class="info-item-grid">
                                <span class="info-label d-block">{{ t('system.uptime', 'Uptime') }}</span>
                                <span class="info-value">{{ system_info.uptime | default('2 days, 5 hours') }}</span>
                            </div>
                        </div>
                        <div class="col-lg-2 col-md-4 col-6 mb-3">
                            <div class="info-item-grid">
                                <span class="info-label d-block">{{ t('system.cpu_cores', 'CPU Cores') }}</span>
                                <span class="info-value">{{ system_info.cpu_cores | default('4') }}</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Services & Network Status -->
    <div class="row services-network-row">
        <!-- System Manager - Services Status -->
        <div class="col-lg-6 mb-4">
            <div class="card h-100 glass-card border-0 services-card">
                <div class="card-header bg-transparent border-0 d-flex justify-content-between align-items-center pt-4 px-4 services-card-header">
                    <h5 class="card-title mb-0 fw-bold text-white services-card-title">
                        <i class="bi bi-gear-fill me-2"></i>{{ t('system.manager', 'System Manager') }}
                    </h5>
                    <button class="btn btn-sm btn-outline-primary" onclick="refreshServices()" title="{{ t('common.refresh', 'Refresh') }}">
                        <i class="bi bi-arrow-clockwise"></i>
                    </button>
                </div>
                <div class="card-body services-card-body">
                    <div id="dashboardServicesContainer">
                        <div class="text-center py-4 text-muted">
                            <i class="bi bi-arrow-clockwise spinning"></i>
                            <p class="mb-0 mt-2">{{ t('system.loading_services', 'Loading services...') }}</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Network Status -->
        <div class="col-lg-6 mb-4">
            <div class="network-card">
                <div class="network-card-header">
                    <h5 class="network-card-title">
                        <i class="bi bi-wifi me-2"></i>
                        {{ t('dashboard.network_status', 'Network Status') }}
                    </h5>
                </div>
                <div class="network-card-body">
                    <div class="network-interface">
                        <div class="interface-header">
                            <i class="bi bi-ethernet interface-icon"></i>
                            <div class="interface-info">
                                <h6>eth0</h6>
                                <span class="interface-status">{{ t('network.connected', 'Connected') }}</span>
                            </div>
                        </div>
                        <div class="interface-details">
                            <div class="network-item">
                                <span class="network-label">{{ t('network.ip_address', 'IP Address') }}</span>
                                <span class="network-value">192.168.1.100</span>
                            </div>
                            <div class="network-item">
                                <span class="network-label">{{ t('network.gateway', 'Gateway') }}</span>
                                <span class="network-value">192.168.1.1</span>
                            </div>
                            <div class="network-item">
                                <span class="network-label">{{ t('network.dns', 'DNS') }}</span>
                                <span class="network-value">8.8.8.8</span>
                            </div>
                        </div>
                    </div>
                    
                    <div class="network-interface">
                        <div class="interface-header">
                            <i class="bi bi-wifi interface-icon"></i>
                            <div class="interface-info">
                                <h6>wlan0</h6>
                                <span class="interface-status">{{ t('network.connected', 'Connected') }}</span>
                            </div>
                        </div>
                        <div class="interface-details">
                            <div class="network-item">
                                <span class="network-label">{{ t('network.ip_address', 'IP Address') }}</span>
                                <span class="network-value">192.168.1.101</span>
                            </div>
                            <div class="network-item">
                                <span class="network-label">{{ t('network.ssid', 'SSID') }}</span>
                                <span class="network-value">HomeNetwork</span>
                            </div>
                            <div class="network-item">
                                <span class="network-label">{{ t('network.signal', 'Signal') }}</span>
                                <span class="network-value">85%</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- System Logs -->
    <div class="row">
        <div class="col-12">
            <div class="logs-card">
                <div class="logs-card-header">
                    <h5 class="logs-card-title">
                        <i class="bi bi-journal-text me-2"></i>
                        {{ t('system.logs', 'System Logs') }}
                    </h5>
                    <div class="logs-controls">
                        <select class="form-select form-select-sm me-2" id="logLevel">
                            <option value="all">{{ t('logs.all_levels', 'All') }}</option>
                            <option value="error">{{ t('logs.errors', 'Errors') }}</option>
                            <option value="warning">{{ t('logs.warnings', 'Warnings') }}</option>
                            <option value="info">{{ t('logs.info', 'Info') }}</option>
                        </select>
                        <button class="btn btn-sm btn-outline-primary" onclick="refreshLogs()">
                            <i class="bi bi-arrow-clockwise"></i>
                        </button>
                    </div>
                </div>
                <div class="logs-card-body">
                    <div class="logs-container">
                        <div class="text-center py-4 text-muted">
                            <i class="bi bi-arrow-clockwise spinning"></i>
                            <p class="mb-0 mt-2">{{ t('system.loading_logs', 'Loading logs...') }}</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Quick Actions -->
    <div class="row">
        <div class="col-12">
            <div class="actions-card">
                <div class="actions-card-header">
                    <h5 class="actions-card-title">
                        <i class="bi bi-lightning me-2"></i>
                        {{ t('dashboard.quick_actions', 'Quick Actions') }}
                    </h5>
                </div>
                <div class="actions-card-body">
                    <div class="quick-actions">
                        <button class="action-btn action-restart" onclick="restartSystem()">
                            <i class="bi bi-arrow-clockwise"></i>
                            <span>{{ t('system.restart', 'Restart') }}</span>
                        </button>
                        <button class="action-btn action-shutdown" onclick="shutdownSystem()">
                            <i class="bi bi-power"></i>
                            <span>{{ t('system.shutdown', 'Shutdown') }}</span>
                        </button>
                        <button class="action-btn action-monitor" onclick="openMonitoring()">
                            <i class="bi bi-graph-up"></i>
                            <span>{{ t('dashboard.monitoring', 'Monitoring') }}</span>
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script id="i18n-json" type="application/json">
{
  "system": {
    "healthy": "{{ t('system.healthy', 'Healthy') }}",
    "warning": "{{ t('system.warning', 'Warning') }}",
    "critical": "{{ t('system.critical', 'Critical') }}",
    "normal": "{{ t('system.normal', 'Normal') }}",
    "running": "{{ t('system.running', 'Running') }}",
    "stopped": "{{ t('system.stopped', 'Stopped') }}",
    "active": "{{ t('system.running', 'Running') }}",
    "connected": "{{ t('system.connected', 'Connected') }}",
    "disconnected": "{{ t('system.disconnected', 'Disconnected') }}",
    "online": "{{ t('system.online', 'Online') }}",
    "offline": "{{ t('system.offline', 'Offline') }}",
    "unknown": "{{ t('system.unknown', 'Unknown') }}"
  }
}
</script>
<script>
// Ensure translations are loaded before dashboard script
window.HostBerryTranslations = {
  "system": {
    "healthy": "{{ t('system.healthy', 'Healthy') }}",
    "warning": "{{ t('system.warning', 'Warning') }}",
    "critical": "{{ t('system.critical', 'Critical') }}",
    "normal": "{{ t('system.normal', 'Normal') }}",
    "running": "{{ t('system.running', 'Running') }}",
    "stopped": "{{ t('system.stopped', 'Stopped') }}",
    "active": "{{ t('system.running', 'Running') }}",
    "connected": "{{ t('system.connected', 'Connected') }}",
    "disconnected": "{{ t('system.disconnected', 'Disconnected') }}",
    "online": "{{ t('system.online', 'Online') }}",
    "offline": "{{ t('system.offline', 'Offline') }}",
    "unknown": "{{ t('system.unknown', 'Unknown') }}"
  }
};
</script>
<script src="/static/js/dashboard.js?v={{ last_update }}"></script>
{% endblock %}
