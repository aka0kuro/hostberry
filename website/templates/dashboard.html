{% extends "base.html" %}

{% block content %}
<div class="dashboard-container">
    <!-- Header Section -->
    <div class="dashboard-header mb-4">
        <div class="row align-items-center">
            <div class="col-12 text-center">
                <h1 class="dashboard-title">
                    <i class="bi bi-speedometer2 me-2"></i>
                    {{ t('navigation.dashboard', 'Dashboard') }}
                </h1>
                <p class="dashboard-subtitle">{{ t('dashboard.welcome', 'Bienvenido a HostBerry') }}</p>
                <div class="dashboard-time">
                    <i class="bi bi-clock me-1"></i>
                    <span id="currentTime">--:--:--</span>
                </div>
            </div>
        </div>
    </div>

    <!-- System Status Cards -->
    <div class="row mb-4 status-cards-row">
        <div class="col-lg-3 col-md-6 col-12 mb-3">
            <div class="status-card cpu-card">
                <div class="status-card-header">
                    <div class="status-icon cpu-icon">
                        <i class="bi bi-cpu"></i>
                    </div>
                    <div class="status-info">
                        <h6>{{ t('system.cpu_usage', 'CPU') }}</h6>
                        <h3>{{ system_stats.cpu_percent | default(25, true) }}%</h3>
                    </div>
                </div>
                <div class="progress">
                    <div class="progress-bar cpu-progress" style="width: {{ system_stats.cpu_percent | default(25, true) }}%"></div>
                </div>
                <div class="status-footer">
                    <span class="status-text status-{{ system_health.cpu }}">
                        {% if system_health.cpu == 'critical' %}
                            {{ t('system.critical', 'Critical') }}
                        {% elif system_health.cpu == 'warning' %}
                            {{ t('system.warning', 'Warning') }}
                        {% else %}
                            {{ t('system.healthy', 'Healthy') }}
                        {% endif %}
                    </span>
                </div>
            </div>
        </div>

        <div class="col-lg-3 col-md-6 col-12 mb-3">
            <div class="status-card memory-card">
                <div class="status-card-header">
                    <div class="status-icon memory-icon">
                        <i class="bi bi-memory"></i>
                    </div>
                    <div class="status-info">
                        <h6>{{ t('system.memory_usage', 'Memory') }}</h6>
                        <h3>{{ system_stats.memory_percent | default(45, true) }}%</h3>
                    </div>
                </div>
                <div class="progress">
                    <div class="progress-bar memory-progress" style="width: {{ system_stats.memory_percent | default(45, true) }}%"></div>
                </div>
                <div class="status-footer">
                    <span class="status-text status-{{ system_health.memory }}">
                        {% if system_health.memory == 'critical' %}
                            {{ t('system.critical', 'Critical') }}
                        {% elif system_health.memory == 'warning' %}
                            {{ t('system.warning', 'Warning') }}
                        {% else %}
                            {{ t('system.healthy', 'Healthy') }}
                        {% endif %}
                    </span>
                </div>
            </div>
        </div>

        <div class="col-lg-3 col-md-6 col-12 mb-3">
            <div class="status-card disk-card">
                <div class="status-card-header">
                    <div class="status-icon disk-icon">
                        <i class="bi bi-hdd"></i>
                    </div>
                    <div class="status-info">
                        <h6>{{ t('system.disk_usage', 'Disk') }}</h6>
                        <h3>{{ system_stats.disk_percent | default(60, true) }}%</h3>
                    </div>
                </div>
                <div class="progress">
                    <div class="progress-bar disk-progress" style="width: {{ system_stats.disk_percent | default(60, true) }}%"></div>
                </div>
                <div class="status-footer">
                    <span class="status-text status-{{ system_health.disk }}">
                        {% if system_health.disk == 'critical' %}
                            {{ t('system.critical', 'Critical') }}
                        {% elif system_health.disk == 'warning' %}
                            {{ t('system.warning', 'Warning') }}
                        {% else %}
                            {{ t('system.healthy', 'Healthy') }}
                        {% endif %}
                    </span>
                </div>
            </div>
        </div>

        <div class="col-lg-3 col-md-6 col-12 mb-3">
            <div class="status-card temp-card">
                <div class="status-card-header">
                    <div class="status-icon temp-icon">
                        <i class="bi bi-thermometer-half"></i>
                    </div>
                    <div class="status-info">
                        <h6>{{ t('system.temperature', 'Temperature') }}</h6>
                        <h3>{{ system_stats.temperature | default(45, true) }}Â°C</h3>
                    </div>
                </div>
                <div class="progress">
                    <div class="progress-bar temp-progress" style="width: {{ (system_stats.temperature | default(45, true) / 100 * 100) | round }}%"></div>
                </div>
                <div class="status-footer">
                    <span class="status-text status-{{ system_health.temperature }}">
                        {% if system_health.temperature == 'critical' %}
                            {{ t('system.critical', 'Critical') }}
                        {% elif system_health.temperature == 'warning' %}
                            {{ t('system.warning', 'Warning') }}
                        {% else %}
                            {{ t('system.normal', 'Normal') }}
                        {% endif %}
                    </span>
                </div>
            </div>
        </div>
    </div>

    <!-- System Information -->
    <div class="row mb-4">
        <div class="col-12">
            <div class="info-card">
                <div class="info-card-header">
                    <h5 class="info-card-title">
                        <i class="bi bi-info-circle me-2"></i>
                        {{ t('system.information', 'System Information') }}
                    </h5>
                </div>
                <div class="info-card-body">
                    <div class="row">
                        <div class="col-lg-2 col-md-4 col-6 mb-3">
                            <div class="info-item-grid">
                                <span class="info-label d-block">{{ t('system.hostname', 'Hostname') }}</span>
                                <span class="info-value">{{ system_info.hostname | default('hostberry') }}</span>
                            </div>
                        </div>
                        <div class="col-lg-2 col-md-4 col-6 mb-3">
                            <div class="info-item-grid">
                                <span class="info-label d-block">{{ t('system.os_version', 'OS Version') }}</span>
                                <span class="info-value">{{ system_info.os_version | default('Raspberry Pi OS') }}</span>
                            </div>
                        </div>
                        <div class="col-lg-2 col-md-4 col-6 mb-3">
                            <div class="info-item-grid">
                                <span class="info-label d-block">{{ t('system.kernel_version', 'Kernel') }}</span>
                                <span class="info-value">{{ system_info.kernel_version | default('Linux 6.8.0') }}</span>
                            </div>
                        </div>
                        <div class="col-lg-2 col-md-4 col-6 mb-3">
                            <div class="info-item-grid">
                                <span class="info-label d-block">{{ t('system.architecture', 'Architecture') }}</span>
                                <span class="info-value">{{ system_info.architecture | default('armv7l') }}</span>
                            </div>
                        </div>
                        <div class="col-lg-2 col-md-4 col-6 mb-3">
                            <div class="info-item-grid">
                                <span class="info-label d-block">{{ t('system.uptime', 'Uptime') }}</span>
                                <span class="info-value">{{ system_info.uptime | default('2 days, 5 hours') }}</span>
                            </div>
                        </div>
                        <div class="col-lg-2 col-md-4 col-6 mb-3">
                            <div class="info-item-grid">
                                <span class="info-label d-block">{{ t('system.cpu_cores', 'CPU Cores') }}</span>
                                <span class="info-value">{{ system_info.cpu_cores | default('4') }}</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Services & Network Status -->
    <div class="row services-network-row">
        <!-- Services Status -->
        <div class="col-lg-6 mb-4">
            <div class="services-card">
                <div class="services-card-header">
                    <h5 class="services-card-title">
                        <i class="bi bi-server me-2"></i>
                        {{ t('system.services', 'Services') }}
                    </h5>
                </div>
                <div class="services-card-body">
                    {% set service_icons = {
                        'hostberry': 'bi bi-gear-fill service-icon hostberry-icon',
                        'nginx': 'bi bi-shield-check service-icon nginx-icon',
                        'fail2ban': 'bi bi-shield-fill service-icon fail2ban-icon',
                        'ufw': 'bi bi-shield-lock service-icon ufw-icon',
                        'ufw firewall': 'bi bi-shield-lock service-icon ufw-icon',
                        'wifi': 'bi bi-wifi service-icon wifi-icon',
                        'ssh': 'bi bi-terminal service-icon ssh-icon',
                        'hostapd': 'bi bi-wifi service-icon wifi-icon',
                        'openvpn': 'bi bi-shield-check service-icon openvpn-icon',
                        'wireguard': 'bi bi-shield-lock service-icon wireguard-icon',
                        'wg-quick': 'bi bi-shield-lock service-icon wireguard-icon',
                        'wg': 'bi bi-shield-lock service-icon wireguard-icon',
                        'dnsmasq': 'bi bi-diagram-3 service-icon dns-icon',
                        'dns': 'bi bi-diagram-3 service-icon dns-icon',
                        'adblock': 'bi bi-shield-x service-icon adblock-icon',
                        'pihole': 'bi bi-shield-x service-icon adblock-icon'
                    } %}
                    {% if services %}
                        {% for service_name, service_status in services.items() %}
                            {% set normalized_name = service_name|lower %}
                            {% set alias = normalized_name.replace('_', '').replace('-', '').replace(' ', '') %}
                            {% set icon_class = service_icons.get(normalized_name) or service_icons.get(alias) or 'bi bi-hdd service-icon default-icon' %}
                            {% set status_value = service_status.status if service_status is mapping and service_status.status is defined else service_status %}
                            {% set status_lower = (status_value|string)|lower %}
                            {% set is_running = status_lower in ['running', 'active', 'online'] %}
                            <div class="service-item">
                                <div class="service-info">
                                    <i class="{{ icon_class }}"></i>
                                    <span class="service-name">{{ service_name|title }}</span>
                                </div>
                                <div class="service-status">
                                    <span class="status-badge {{ 'status-running' if is_running else 'status-stopped' }}">
                                        {{ t('system.running', 'Active') if is_running else t('system.stopped', 'Stopped') }}
                                    </span>
                                </div>
                            </div>
                        {% endfor %}
                    {% else %}
                        <div class="text-muted small">
                            {{ t('system.no_services', 'No services to display') }}
                        </div>
                    {% endif %}
                </div>
            </div>
        </div>

        <!-- Network Status -->
        <div class="col-lg-6 mb-4">
            <div class="network-card">
                <div class="network-card-header">
                    <h5 class="network-card-title">
                        <i class="bi bi-wifi me-2"></i>
                        {{ t('dashboard.network_status', 'Network Status') }}
                    </h5>
                </div>
                <div class="network-card-body">
                    <div class="network-interface">
                        <div class="interface-header">
                            <i class="bi bi-ethernet interface-icon"></i>
                            <div class="interface-info">
                                <h6>eth0</h6>
                                <span class="interface-status">{{ t('network.connected', 'Connected') }}</span>
                            </div>
                        </div>
                        <div class="interface-details">
                            <div class="network-item">
                                <span class="network-label">{{ t('network.ip_address', 'IP') }}</span>
                                <span class="network-value">192.168.1.100</span>
                            </div>
                            <div class="network-item">
                                <span class="network-label">{{ t('network.gateway', 'Gateway') }}</span>
                                <span class="network-value">192.168.1.1</span>
                            </div>
                            <div class="network-item">
                                <span class="network-label">{{ t('network.dns', 'DNS') }}</span>
                                <span class="network-value">8.8.8.8</span>
                            </div>
                        </div>
                    </div>
                    
                    <div class="network-interface">
                        <div class="interface-header">
                            <i class="bi bi-wifi interface-icon"></i>
                            <div class="interface-info">
                                <h6>wlan0</h6>
                                <span class="interface-status">{{ t('network.connected', 'Connected') }}</span>
                            </div>
                        </div>
                        <div class="interface-details">
                            <div class="network-item">
                                <span class="network-label">{{ t('network.ip_address', 'IP') }}</span>
                                <span class="network-value">192.168.1.101</span>
                            </div>
                            <div class="network-item">
                                <span class="network-label">{{ t('network.ssid', 'SSID') }}</span>
                                <span class="network-value">HomeNetwork</span>
                            </div>
                            <div class="network-item">
                                <span class="network-label">{{ t('network.signal', 'Signal') }}</span>
                                <span class="network-value">85%</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- System Logs -->
    <div class="row">
        <div class="col-12">
            <div class="logs-card">
                <div class="logs-card-header">
                    <h5 class="logs-card-title">
                        <i class="bi bi-journal-text me-2"></i>
                        {{ t('system.logs', 'System Logs') }}
                    </h5>
                    <div class="logs-controls">
                        <select class="form-select form-select-sm me-2" id="logLevel">
                            <option value="all">{{ t('logs.all_levels', 'All') }}</option>
                            <option value="error">{{ t('logs.errors', 'Errors') }}</option>
                            <option value="warning">{{ t('logs.warnings', 'Warnings') }}</option>
                            <option value="info">{{ t('logs.info', 'Info') }}</option>
                        </select>
                        <button class="btn btn-sm btn-outline-primary" onclick="refreshLogs()">
                            <i class="bi bi-arrow-clockwise"></i>
                        </button>
                    </div>
                </div>
                <div class="logs-card-body">
                    <div class="logs-container">
                        <div class="text-center py-4 text-muted">
                            <i class="bi bi-arrow-clockwise spinning"></i>
                            <p class="mb-0 mt-2">{{ t('system.loading_logs', 'Loading logs...') }}</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Quick Actions -->
    <div class="row">
        <div class="col-12">
            <div class="actions-card">
                <div class="actions-card-header">
                    <h5 class="actions-card-title">
                        <i class="bi bi-lightning me-2"></i>
                        {{ t('dashboard.quick_actions', 'Quick Actions') }}
                    </h5>
                </div>
                <div class="actions-card-body">
                    <div class="quick-actions">
                        <button class="action-btn action-restart" onclick="restartSystem()">
                            <i class="bi bi-arrow-clockwise"></i>
                            <span>{{ t('system.restart', 'Restart') }}</span>
                        </button>
                        <button class="action-btn action-shutdown" onclick="shutdownSystem()">
                            <i class="bi bi-power"></i>
                            <span>{{ t('system.shutdown', 'Shutdown') }}</span>
                        </button>
                        <button class="action-btn action-backup" onclick="backupSystem()">
                            <i class="bi bi-cloud-arrow-up"></i>
                            <span>{{ t('system.backup', 'Backup') }}</span>
                        </button>
                        <button class="action-btn action-update" onclick="checkUpdates()">
                            <i class="bi bi-arrow-up-circle"></i>
                            <span>{{ t('system.updates', 'Updates') }}</span>
                        </button>
                        <button class="action-btn action-monitor" onclick="openMonitoring()">
                            <i class="bi bi-graph-up"></i>
                            <span>{{ t('dashboard.monitoring', 'Monitoring') }}</span>
                        </button>
                        <button class="action-btn action-security" onclick="openSecurity()">
                            <i class="bi bi-shield-lock"></i>
                            <span>{{ t('navigation.security', 'Security') }}</span>
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script id="i18n-json" type="application/json">
{
  "system": {
    "healthy": "{{ t('system.healthy', 'Healthy') }}",
    "warning": "{{ t('system.warning', 'Warning') }}",
    "critical": "{{ t('system.critical', 'Critical') }}",
    "normal": "{{ t('system.normal', 'Normal') }}"
  }
}
</script>
<script>
// Ensure translations are loaded before dashboard script
window.HostBerryTranslations = {
  "system": {
    "healthy": "{{ t('system.healthy', 'Healthy') }}",
    "warning": "{{ t('system.warning', 'Warning') }}",
    "critical": "{{ t('system.critical', 'Critical') }}",
    "normal": "{{ t('system.normal', 'Normal') }}"
  }
};
</script>
<script src="/static/js/dashboard.js?v={{ last_update }}"></script>
{% endblock %}
